####  계정
root(관리자)와 일반사용자로 구분한다.

각각 계정은 흔히 사용하는 ID가 아니라 번호로 부여하는 

==**UID(User Identity)**로 관리한다.==
==일반사용자 계정의 UID 범위는 /etc/login.defs 에 정의되어 있다.==


```
[root@localhost ~]# cat /etc/login.defs
...
# Min/max values for automatic uid selection in useradd
#
UID_MIN                  1000
UID_MAX                 60000
# System accounts
SYS_UID_MIN               201
SYS_UID_MAX               999
```


- 루트 계정 : 모든 권한을 가진 특별한 사용자 - UID 0번
- 시스템 계정 : 리눅스 설치시 기본으로 생성되는 계정
	- bin, daemon, adm, lp ...
	- 일반적으로 로그인이 불가함.
- 사용자 계정 : 실제 리눅스 사용자를 위한 계정

`[root@localhost ~]# useradd shchoi`
`[root@localhost ~]# passwd shchoi`
`Changing password for user shchoi.`
`New password:`
`BAD PASSWORD: The password is shorter than 8 characters`
`Retype new password:`
`passwd: all authentication tokens updated successfully.`

### ==pid, uid 번호의 의미==

#### UID
user Identifier

**RedHat 6이하**
* 0번 : root
-> 다른 계정의 UID 값을 0으로 변경한다면 관리자와 마찬가지로 모든 권한을 가질 수 있다.
* 1 ~ 499 : 시스템 계정
* 500 ~ 60000 : 일반 계정

**CentOS7 기준**
* 0번 : root
* 1 ~ 200 : 시스템 프로세스의 정적으로 할당된 시스템 사용자 범위
* 201 ~ 999 : 파일 시스템의 시스템 프로세스 범위
* 1000 ~ : 일반 계정(사용자 할당)

보안 상의 문제로 동일한 UID 사용 x




#### 계정 관련된 파일 위치

`cat /etc/passwd`

```
[root@localhost ~]# cat /etc/passwd
root:x:0:0:root:/root:/bin/bash
bin:x:1:1:bin:/bin:/sbin/nologin
daemon:x:2:2:daemon:/sbin:/sbin/nologin
adm:x:3:4:adm:/var/adm:/sbin/nologin
lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin
sync:x:5:0:sync:/sbin:/bin/sync
shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown
halt:x:7:0:halt:/sbin:/sbin/halt
mail:x:8:12:mail:/var/spool/mail:/sbin/nologin
operator:x:11:0:operator:/root:/sbin/nologin
games:x:12:100:games:/usr/games:/sbin/nologin
ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin
nobody:x:65534:65534:Kernel Overflow User:/:/sbin/nologin
dbus:x:81:81:System message bus:/:/sbin/nologin
systemd-coredump:x:999:997:systemd Core Dumper:/:/sbin/nologin
systemd-resolve:x:193:193:systemd Resolver:/:/sbin/nologin
tss:x:59:59:Account used for TPM access:/:/sbin/nologin
polkitd:x:998:996:User for polkitd:/:/sbin/nologin
libstoragemgmt:x:997:993:daemon account for libstoragemgmt:/var/run/lsm:/sbin/nologin
sssd:x:996:992:User for sssd:/:/sbin/nologin
cockpit-ws:x:995:991:User for cockpit web service:/nonexisting:/sbin/nologin
cockpit-wsinstance:x:994:990:User for cockpit-ws instances:/nonexisting:/sbin/nologin
chrony:x:993:989::/var/lib/chrony:/sbin/nologin
sshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin
shchoi:x:1000:1000:shchoi:/home/shchoi:/bin/bash

```
`root:x:0:superuser` 보다는 `sudoers`에 포함 권고


#### 계정이 잠겼을 경우 확인하는 방법

`passwd -u username`

![[Pasted image 20250226144945.png]]
```
[root@localhost ~]# passwd -u shchoi
Unlocking password for user shchoi.
passwd: Success

```
`grep username /etc/shadow`

패스워드의 lock이 풀리면 /etc/shadow 파일의 사용자의 암호화된 패스워드 자리의 맨 앞에 있던 !!가 제거된다.


### ==계정 잠금 임계값 설정하기==

Bruce Force 혹은 사전 대입 공격 대비

`[root@localhost ~]# vi /etc/security/pwquality.conf`

- minlen -> pw 최소 길이
- dcredit -> 최소 숫자 개수
- ucredit -> 최소 대문자 개수
- lcredit -> 최소 소문자 개수
- ocredit -> 최소 특수문자 개수
- maxrepeat -> 최소 같은 character(숫자, 문자) 반복 횟수

RHEL 7 이상, Rocky Linux 기준 -> ==pam_faillock==

`/etc/pam.d/system-auth`와 `/etc/pam.d/password-auth` 파일을 수정

```
auth required pam_faillock.so preauth silent deny=5 unlock_time=600 fail_interval=900 
account required pam_faillock.so
```

system-auth : 시스템에서 바로 인증 하는 것
password-auth : ssh등 원격에서 접근할 때




`[root@localhost ~]# faillock --user shchoi`
`When                Type  Source                                           Valid`
`shchoi:`
`When                Type  Source                                           Valid`
`2025-03-05 19:58:48 RHOST 192.168.38.1                                         V`
`2025-03-05 19:58:52 RHOST 192.168.38.1                                         V`


### root 권한 주기

`cat /etc/passwd`
```
shchoi:x:1000:1000:shchoi:/home/shchoi:/bin/bash
shchoi2:x:1001:1001::/home/shchoi2:/bin/bash
```

#### ==1. /etc/sudoers==

특정 사용자가 비밀번호 없이 root 사용자로서 명령을 수행할 수 있도록 하는 설정
#### 2. wheel 그룹
sudoers 파일에 세팅돼있다. 
wheel 그룹에 추가하면 sudo 명령이 가능하다.

`sudo usermod -aG wheel shchoi`

shchoi를 wheel 그룹에 추가한다.

```
[root@localhost ~]# sudo visudo
## Allows people in group wheel to run all commands
%wheel  ALL=(ALL)       ALL

```
==visudo 명령==을 통해 /etc/sudoers 파일을 편집한다.
wheel 그룹 내 user의 권한 확인


```
root       ALL=(ALL)          ALL
사용자   호스트 |사용자(계정)   명령어
```

호스트 -> 특정 서버에 대해 권한

ex. 
`sudo whoami`  #root 계정으로
`sudo -u apache whoami` #apache 계정으로 실행

`
> `# %wheel        ALL=(ALL)       NOPASSWD: ALL

-> wheel 그룹 사용자는 sudo로 모든 명령어 실행 가능

-> **NOPASSWD: ALL** : 비밀번호 없이 모든 명령어 실행 가능하다.

> `shchoi    ALL=(ALL)       ALL

 -> shchoi 는  모든 명령어 sudo로 실행 가능


> `choi  ALL=(ALL) NOPASSWD: /usr/bin/systemctl restart apache2`

-> choi는 `/usr/bin/systemctl restart apache2`를 비밀번호 없이 실행 가능

> `cho  ALL=(apache) ALL`

-> cho는 모든 명령어를 sudo로 실행 가능하나, `-u apache`로 실행해야 한다.


### 관리자 권한으로 계정 잠금 풀어주는 방법과 기준

```
[root@localhost ~]# faillock --user shchoi2
shchoi2:
When                Type  Source                                           Valid
2025-03-05 20:49:49 RHOST 192.168.38.1                                         V
2025-03-05 20:49:52 RHOST 192.168.38.1                                         V
[root@localhost ~]# faillock --user shchoi2 --reset
[root@localhost ~]# faillock --user shchoi2
shchoi2:
When                Type  Source                                           Valid
```

### 계정 확인

#### 명령어

`[root@localhost ~]# su - shchoi` 
`Last login: Wed Mar 5 02:47:46 EST 2025 on pts/0` 
`[shchoi@localhost ~]$ id` 
`uid=1001(shchoi) gid=1001(shchoi) groups=1001(shchoi) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023` 
`[shchoi@localhost ~]$ who 
`root tty1 2025-03-05 03:04` 
`root pts/0 2025-03-05 03:04 (192.168.38.1) [shchoi@localhost ~]$ users root root` 
`[shchoi@localhost ~]$ w` 
`03:04:51 up 1 min, 2 users, load average: 2.35, 1.09, 0.41 USER TTY FROM LOGIN@ IDLE JCPU PCPU WHAT` 
`root tty1 - 03:04 50.00s 0.05s 0.05s -bash` 
`root pts/0 192.168.38.1 03:04 3.00s 0.10s 0.02s w` 
`[shchoi@localhost ~]$ whoami` 
`shchoi`

**id, whoami -> shchoi**
현재 프로세스의 실제 사용자 정보

**users, who, w -> root**
utmp의 로그인 기록을 읽어 표시
### su vs su -

su 를 하게 되면 환경 변수를 유지한 채 다른 사용자로 전환
vs
su - 를 사용하게 되면 새로운 사용자의 로그인 환경을 불러온다.



### chage
chage age, 리눅스 사용자 계정의 비밀번호 만료 정책 및 계정 잠금 관련 설정을 관리한다.
```
[root@localhost ~]# chage -l cho
Last password change                                    : Mar 12, 2025
Password expires                                        : never
Password inactive                                       : never
Account expires                                         : never
Minimum number of days between password change          : 0
Maximum number of days between password change          : 99999
Number of days of warning before password expires       : 7

```
- Last password change
마지막으로 비밀번호가 바뀐 날짜

- Password expires
비밀번호 만료 일

- Password inactive
비밀번호 만료 후 계정 비활성화 기간

- Account expires ㅣ
계정 만료일

- Minimum number of days between password change
비밀번호 최소 변경 주기(n일 동안 변경 x)

- Maximum number of days between password change
비밀번호 최대 변경 주기(n일 이후 강제 변경)

- Number of days of warning before password expires 
비밀번호 만료 전 경고 오는 기간

```
[root@localhost ~]# chage -M 30 shchoi
# 변경 주기 30일
[root@localhost ~]# chage -m 5 shchoi
# 5일 이후부터 변경 가능
[root@localhost ~]# chage -W 7 shchoi
# 7일 전 경고
[root@localhost ~]# chage -I 30 shchoi
# 비밀번호 만료 후 30일 후 계정 비활성화
[root@localhost ~]# chage -E 2026-03-12 shchoi
# 만료 날짜
[root@localhost ~]# chage -E -1 shchoi
# 계정 만료 해제

```


```
[root@localhost ~]# chage -d 0 shchoi
# 즉시 비밀번호 변경 강제


# 다른 세션에서 shchoi로 로그인하면

Last login: Wed Mar 12 13:14:31 2025
WARNING: Your password has expired.
You must change your password now and login again!
Changing password for user shchoi.
Current password:
New password:
Retype new password:
passwd: all authentication tokens updated successfully.

```

설정 후 확인

```
[root@localhost ~]# chage -l shchoi
Last password change                                    : Mar 12, 2025
Password expires                                        : Apr 11, 2025
Password inactive                                       : May 11, 2025
Account expires                                         : never
Minimum number of days between password change          : 5
Maximum number of days between password change          : 30
Number of days of warning before password expires       : 7

```