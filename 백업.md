
## Backup
스토리지에 저장된 데이터의 사본을 만들어 ==다른 곳에 위치==시키는 것
예상치 못한 상황이 발생했을 때 전체 또는 일부 데이터가 손실될 위험을 줄인다.
시스템과 애플리케이션을 이전에 원하는 상태로 복원할 수 있다.

#### 스냅샷과 백업의 차이

스냅샷 : 마치 사진 찍듯이 특정 시점에 스토리지의 파일 시스템을 포착해 보관하는 기술
장애나 데이터 손상 시 스냅샷을 생성한 시점으로 데이터를 복구할 수 있다.

* ==메타데이터의 복사본==에 해당하기 때문에 생성하는 데 오랜 시간이 걸리지 않고, 장애 상황이 발생해도 빠르게 데이터를 복원할 수 있습니다.
* 초기 생성 시 혹은 데이터의 변경이 있기 전까지는 스토리지의 공간을 차지하지 않는다. 

-> 스냅샷은 원본의 완벽한 복사본이 아니기 때문에 원본 데이터가 저장된 공간에 오류가 발생할 경우 복구가 불가능하다.
->  ==원본 데이터가 저장되는 스토리지 내에 저장==된다.

참고 : 스냅샷 백업 - [[LVM 설정]]



## 백업의 종류

### 전체 백업(Full backup)
![[Pasted image 20250408171307.png]]
전체 데이터를 백업하는 것
Full Backup이 이루어지는 동안에도 트랜잭션이 계속 진행될 수 있는데, 이때 커밋된 트랜잭션에 대한 로그들도 모두 함께 백업 된다.
데이터 변경 유무와 상관 없이 전체 데이터의 복사본을 만든다. -> 독립적으로 복원 가능
백업 시간이 오래 걸리고 저장공간이 많이 필요하다.


### 차등 백업(Differantial Backup)
![[Pasted image 20250408171534.png]]

 마지막 전체 백업 이후에 변경/추가된 데이터를 ==모두 포함==하여 백업하는 방식
 풀 백업 이후 다음 백업 주기에 의해 변경된 데이터를 합산하여 백업하는 방식
 복구 시 : 전체 백업 + 마지막 차등 백업
 ex. 일요일 복구 시 : 월 + 토
 증분 보다 데이터 복원이 간편하다.
 

### 증분 백업(Incremental Backup)
![[Pasted image 20250408173531.png]]
마지막 전체 백업 이후에 ==변경/추가된 데이터만== 백업
데이터 복구 시에는 모든 증분 백업이 필요하므로 다른 백업 방식 보다 복구 시간이 가장 오래 걸린다.
서로 종속적이다. -> 일요일 백업 시 : 월~토 까지 6개의 데이터가 온전히 필요


## rsync

 빠른 파일 전송을 수행하며 시스템 간에 데이터를 동기화하는 데 사용되는 오픈소스.
리눅스 시스템에서 가장 많이 사용하는 백업 및 동기화 명령어이다.
잘못 사용했다가 원본 데이터가 삭제될 수 있으니 주의해야 한다.
`cp` 보다 속성이 다양해서 - 속성 그대로 복사, 파일 변경 여부 등 - 더 자주 사용된다.

```
[root@localhost cron]# rsync -av --delete /etc /backup/
sending incremental file list
created directory /backup
etc/
etc/.pwd.lock
etc/.updated
etc/DIR_COLORS

... (생략)...

[root@localhost cron]# ls /backup
etc

```
- -a : archive, 백업에 무조건 사용되는 옵션, 디렉토리 구조나 링크, 퍼미션, onwer 등등 옵션 모두 유지
- -v : verbose, 백업하는 과정 출력됨
- --delete : 백업하다가 원본 디렉토리엔 없으면 삭제하는 옵션. 백업-원본 동기화 상태이고 싶을 때 사용. 잘못하면 날아가니 주의

#### tar + [[cron]] 으로 자동 백업 스크립트 만들기**

주기적으로 디렉토리를 `tar.gz`로 묶어서 저장한다.

```
[root@localhost ~]# vi backup.sh

#!/bin/bash
BACKUP_DIR="/backup"
DATE=$(date +%F)
tar -czf $BACKUP_DIR/etc-backup-$DATE.tar.gz /etc

```

```
[root@localhost ~]# crontab -e
    `0 2 * * * /usr/local/bin/backup.sh`

crontab: installing new crontab
```
cron을 등록한다.

## DR(Data Recovery)

자연재해나 인간의 행동(또는 실수)으로 인한 재해가 발생한 후 조직에서 IT 인프라에 대한 액세스 및 기능을 복원할 수 있는 기능

#### RTO(Recovery Time Objective)
목표 복구 시간
서비스를 복구하는 데 까지 걸리는 최대 허용 시간

#### RPO(Recovery Point Objective)
목표 복구 시점
시스템 장애나 재해와 같은 예상치 못한 사건으로 인해 비즈니스에서 손실할 수 있는 최대 데이터 양

![[Pasted image 20250408182019.png]]


### 사이트 종류
#### Mirror Site
RTO : 즉시
RPO : 거의 0
Active-Active
주 센터와 ==동일한 수준의 자원==을 원격지에 구축하고 ==Active 상태==로 실시간 동시 서비스를 제공하는 방식
무중단 운영 방식

#### Hot Site(핫 사이트)
RTO: 수시간 이내
RPO : 수 분 이내
Active-Standby
주 센터와 동일한 수준의 정보기술 자원을 원격지에 구축하여 ==Stand-by 상태로 유지==하며 Active 상태로 서비스 제공

#### Warm Site(웜 사이트)
RTO : 수일~ 수주
RPO : 수 시간 ~ 1일
중요성이 높은 정보 기술 자원만 부분적으로 보유하는 방식
실시간 미러링을 수행하지 않는다
복구 수준이 완전하지 않으며 완전한 복구까지는 다소의 시일이 소요된다. 
데이터는 주기적(수시간~1일)으로 백업을 시행
구축 및 유지 비용이 저렴

#### Cold Site( 콜드 사이트)
RTO: 수주~ 수개월
RPO : 수주 ~ 수개월
==데이터만 원격지에 보관==하고 서비스를 위한 정보 자원은 확보하지 않거나 ==장소 등 최소한으로만 확보==하고 재해 발생 시에 데이터를 근간으로 필요한 정보자원을 조달하여 복구하는 방식. 
-> 장비가 구비가 안되어 있음
-> 그냥 건물 + 전기 + 네트워크 정도만 있는 상태
일 단위나 주 단위 주기로 원격지에 백업
구축 및 유지 비용이 가장 저렴


### IDC
Internet Data Center
인터넷 연결 시 필요한 서버를 모아 설립한 시설
서버 컴퓨터와 네트워크 회선 등이 있다.
정전이 절대 되지 않게 설계한다.

### 3-2-1 백업 전략
- 원본 포함 최소 **3개**의 백업 데이터가 필요하다.
- **두 가지** 다른 유형의 저장매체에 저장한다.
- 백업 데이터 **1개는** 오프사이트(다른 IDC, 지역. ..)에 보관한다.